{"version":3,"file":"SubplotCreator.js","names":["_react","_interopRequireWildcard","require","_Dropdown","_interopRequireDefault","_Info","_propTypes","_constants","_Button","_plotlyIcons","_lib","_2","e","__esModule","default","_getRequireWildcardCache","WeakMap","r","t","has","get","n","__proto__","a","Object","defineProperty","getOwnPropertyDescriptor","u","hasOwnProperty","call","i","set","enterModule","reactHotLoaderGlobal","undefined","module","__signature__","signature","UnconnectedSingleSubplotCreator","Component","canAddSubplot","currentAxisId","props","fullContainer","attr","currentTraceIndex","index","context","fullData","some","d","addAndUpdateSubplot","layoutAttr","updateContainer","fullLayout","_subplots","subplots","lastSubplotNumber","Number","length","split","SUBPLOT_TO_ATTR","layout","updateSubplot","update","currentSubplotId","data","subplotToBeGarbageCollected","trace","onUpdate","type","EDITOR_ACTIONS","UPDATE_TRACES","payload","traceIndexes","render","icon","createElement","PlusIcon","extraComponent","variant","onClick","label","clearable","options","updatePlot","__reactstandin__regenerateByEval","key","code","eval","propTypes","PropTypes","string","array","container","object","func","contextTypes","SingleSubplotCreator","connectToContainer","UnconnectedSubplotCreator","subplotType","traceTypeToAxisType","isFirstTraceOfAxisType","filter","localize","_","getOptions","map","subplotId","getSubplotTitle","value","PlotlySection","name","subplotName","setPanel","_default","modifyPlotProps","plotProps","isVisible","_default2","exports","reactHotLoader","register","leaveModule"],"sources":["../../../src/components/fields/SubplotCreator.js"],"sourcesContent":["import React, {Component} from 'react';\nimport Dropdown from './Dropdown';\nimport Info from './Info';\nimport PropTypes from 'prop-types';\nimport {EDITOR_ACTIONS, SUBPLOT_TO_ATTR, subplotName} from 'lib/constants';\nimport Button from '../widgets/Button';\nimport {PlusIcon} from 'plotly-icons';\nimport {connectToContainer, traceTypeToAxisType, getSubplotTitle} from 'lib';\nimport {PlotlySection} from 'components';\n\nclass UnconnectedSingleSubplotCreator extends Component {\n  canAddSubplot() {\n    const currentAxisId = this.props.fullContainer[this.props.attr];\n    const currentTraceIndex = this.props.fullContainer.index;\n    return this.context.fullData.some(\n      (d) => d.index !== currentTraceIndex && d[this.props.attr] === currentAxisId\n    );\n  }\n\n  addAndUpdateSubplot() {\n    const {attr, layoutAttr, updateContainer} = this.props;\n    const {\n      fullLayout: {_subplots: subplots},\n    } = this.context;\n    const lastSubplotNumber =\n      Number(\n        subplots[layoutAttr][subplots[layoutAttr].length - 1].split(\n          SUBPLOT_TO_ATTR[layoutAttr].layout\n        )[1]\n      ) || 1;\n\n    updateContainer({\n      [attr]: SUBPLOT_TO_ATTR[layoutAttr].layout + (lastSubplotNumber + 1),\n    });\n  }\n\n  updateSubplot(update) {\n    const currentSubplotId = this.props.fullContainer[SUBPLOT_TO_ATTR[this.props.layoutAttr].data];\n    let subplotToBeGarbageCollected = null;\n\n    // When we select another subplot, make sure no unused axes are left\n    if (\n      currentSubplotId !== update &&\n      !this.context.fullData.some(\n        (trace) =>\n          trace[SUBPLOT_TO_ATTR[this.props.layoutAttr].data] === currentSubplotId &&\n          trace.index !== this.props.fullContainer.index\n      )\n    ) {\n      subplotToBeGarbageCollected = currentSubplotId;\n    }\n\n    this.context.onUpdate({\n      type: EDITOR_ACTIONS.UPDATE_TRACES,\n      payload: {\n        subplotToBeGarbageCollected,\n        update: {[this.props.attr]: update},\n        traceIndexes: [this.props.fullContainer.index],\n      },\n    });\n  }\n\n  render() {\n    const icon = <PlusIcon />;\n    const extraComponent = this.canAddSubplot() ? (\n      <Button variant=\"no-text\" icon={icon} onClick={() => this.addAndUpdateSubplot()} />\n    ) : (\n      <Button variant=\"no-text--disabled\" icon={icon} onClick={() => {}} />\n    );\n\n    return (\n      <Dropdown\n        label={this.props.label}\n        attr={this.props.attr}\n        clearable={false}\n        options={this.props.options}\n        updatePlot={(u) => this.updateSubplot(u)}\n        extraComponent={extraComponent}\n      />\n    );\n  }\n}\n\nUnconnectedSingleSubplotCreator.propTypes = {\n  attr: PropTypes.string,\n  layoutAttr: PropTypes.string,\n  label: PropTypes.string,\n  options: PropTypes.array,\n  container: PropTypes.object,\n  fullContainer: PropTypes.object,\n  updateContainer: PropTypes.func,\n};\n\nUnconnectedSingleSubplotCreator.contextTypes = {\n  fullLayout: PropTypes.object,\n  data: PropTypes.array,\n  fullData: PropTypes.array,\n  onUpdate: PropTypes.func,\n};\n\nconst SingleSubplotCreator = connectToContainer(UnconnectedSingleSubplotCreator);\n\nclass UnconnectedSubplotCreator extends Component {\n  render() {\n    const subplotType = traceTypeToAxisType(this.props.container.type);\n    if (!['geo', 'mapbox', 'polar', 'gl3d', 'ternary'].some((t) => t === subplotType)) {\n      return null;\n    }\n\n    const isFirstTraceOfAxisType =\n      this.context.data.filter((d) => traceTypeToAxisType(d.type) === subplotType).length === 1;\n    if (isFirstTraceOfAxisType) {\n      return null;\n    }\n\n    const {fullLayout, localize: _} = this.context;\n\n    function getOptions(subplotType) {\n      return fullLayout._subplots[subplotType].map((subplotId) => ({\n        label: getSubplotTitle(subplotId, subplotType, _),\n        value: subplotId,\n      }));\n    }\n\n    return (\n      <PlotlySection name={_('Subplots to Use')}>\n        <SingleSubplotCreator\n          attr={SUBPLOT_TO_ATTR[subplotType].data}\n          layoutAttr={subplotType}\n          label={subplotName(SUBPLOT_TO_ATTR[subplotType].layout, _)}\n          options={getOptions(subplotType)}\n        />\n        <Info>\n          {_('You can style and position your subplots in the ')}\n          <a onClick={() => this.context.setPanel('Structure', 'Subplots')}>{_('Subplots')}</a>\n          {_(' panel.')}\n        </Info>\n      </PlotlySection>\n    );\n  }\n}\n\nUnconnectedSubplotCreator.propTypes = {\n  container: PropTypes.object,\n  fullContainer: PropTypes.object,\n};\n\nUnconnectedSubplotCreator.contextTypes = {\n  data: PropTypes.array,\n  fullData: PropTypes.array,\n  fullLayout: PropTypes.object,\n  localize: PropTypes.func,\n  setPanel: PropTypes.func,\n};\n\nexport default connectToContainer(UnconnectedSubplotCreator, {\n  modifyPlotProps: (props, context, plotProps) => {\n    const {data} = context;\n    const {fullContainer} = plotProps;\n\n    plotProps.isVisible =\n      data.length > 1 &&\n      data[fullContainer.index] &&\n      ['geo', 'mapbox', 'polar', 'gl3d', 'ternary'].some(\n        (t) => t === traceTypeToAxisType(data[fullContainer.index].type)\n      );\n  },\n});\n"],"mappings":"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","ignoreList":[]}