"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.default=void 0;var _react=_interopRequireWildcard(require("react"));var _Dropdown=_interopRequireDefault(require("./Dropdown"));var _Info=_interopRequireDefault(require("./Info"));var _propTypes=_interopRequireDefault(require("prop-types"));var _constants=require("../../lib/constants");var _Button=_interopRequireDefault(require("../widgets/Button"));var _plotlyIcons=require("plotly-icons");var _lib=require("../../lib");var _2=require("./..");function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}function _getRequireWildcardCache(e){if("function"!=typeof WeakMap)return null;var r=new WeakMap,t=new WeakMap;return(_getRequireWildcardCache=function _getRequireWildcardCache(e){return e?t:r})(e)}function _interopRequireWildcard(e,r){if(!r&&e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var t=_getRequireWildcardCache(r);if(t&&t.has(e))return t.get(e);var n={__proto__:null},a=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var u in e)if("default"!==u&&{}.hasOwnProperty.call(e,u)){var i=a?Object.getOwnPropertyDescriptor(e,u):null;i&&(i.get||i.set)?Object.defineProperty(n,u,i):n[u]=e[u]}return n.default=e,t&&t.set(e,n),n}(function(){var enterModule=typeof reactHotLoaderGlobal!=="undefined"?reactHotLoaderGlobal.enterModule:undefined;enterModule&&enterModule(module)})();var __signature__=typeof reactHotLoaderGlobal!=="undefined"?reactHotLoaderGlobal.default.signature:function(a){return a};class UnconnectedSingleSubplotCreator extends _react.Component{canAddSubplot(){var currentAxisId=this.props.fullContainer[this.props.attr];var currentTraceIndex=this.props.fullContainer.index;return this.context.fullData.some(d=>d.index!==currentTraceIndex&&d[this.props.attr]===currentAxisId)}addAndUpdateSubplot(){var{attr,layoutAttr,updateContainer}=this.props;var{fullLayout:{_subplots:subplots}}=this.context;var lastSubplotNumber=Number(subplots[layoutAttr][subplots[layoutAttr].length-1].split(_constants.SUBPLOT_TO_ATTR[layoutAttr].layout)[1])||1;updateContainer({[attr]:_constants.SUBPLOT_TO_ATTR[layoutAttr].layout+(lastSubplotNumber+1)})}updateSubplot(update){var currentSubplotId=this.props.fullContainer[_constants.SUBPLOT_TO_ATTR[this.props.layoutAttr].data];var subplotToBeGarbageCollected=null;if(currentSubplotId!==update&&!this.context.fullData.some(trace=>trace[_constants.SUBPLOT_TO_ATTR[this.props.layoutAttr].data]===currentSubplotId&&trace.index!==this.props.fullContainer.index)){subplotToBeGarbageCollected=currentSubplotId}this.context.onUpdate({type:_constants.EDITOR_ACTIONS.UPDATE_TRACES,payload:{subplotToBeGarbageCollected,update:{[this.props.attr]:update},traceIndexes:[this.props.fullContainer.index]}})}render(){var icon=_react.default.createElement(_plotlyIcons.PlusIcon,null);var extraComponent=this.canAddSubplot()?_react.default.createElement(_Button.default,{variant:"no-text",icon:icon,onClick:()=>this.addAndUpdateSubplot()}):_react.default.createElement(_Button.default,{variant:"no-text--disabled",icon:icon,onClick:()=>{}});return _react.default.createElement(_Dropdown.default,{label:this.props.label,attr:this.props.attr,clearable:false,options:this.props.options,updatePlot:u=>this.updateSubplot(u),extraComponent:extraComponent})}__reactstandin__regenerateByEval(key,code){this[key]=eval(code)}}UnconnectedSingleSubplotCreator.propTypes={attr:_propTypes.default.string,layoutAttr:_propTypes.default.string,label:_propTypes.default.string,options:_propTypes.default.array,container:_propTypes.default.object,fullContainer:_propTypes.default.object,updateContainer:_propTypes.default.func};UnconnectedSingleSubplotCreator.contextTypes={fullLayout:_propTypes.default.object,data:_propTypes.default.array,fullData:_propTypes.default.array,onUpdate:_propTypes.default.func};var SingleSubplotCreator=(0,_lib.connectToContainer)(UnconnectedSingleSubplotCreator);class UnconnectedSubplotCreator extends _react.Component{render(){var subplotType=(0,_lib.traceTypeToAxisType)(this.props.container.type);if(!["geo","mapbox","polar","gl3d","ternary"].some(t=>t===subplotType)){return null}var isFirstTraceOfAxisType=this.context.data.filter(d=>(0,_lib.traceTypeToAxisType)(d.type)===subplotType).length===1;if(isFirstTraceOfAxisType){return null}var{fullLayout,localize:_}=this.context;function getOptions(subplotType){return fullLayout._subplots[subplotType].map(subplotId=>({label:(0,_lib.getSubplotTitle)(subplotId,subplotType,_),value:subplotId}))}return _react.default.createElement(_2.PlotlySection,{name:_("Subplots to Use")},_react.default.createElement(SingleSubplotCreator,{attr:_constants.SUBPLOT_TO_ATTR[subplotType].data,layoutAttr:subplotType,label:(0,_constants.subplotName)(_constants.SUBPLOT_TO_ATTR[subplotType].layout,_),options:getOptions(subplotType)}),_react.default.createElement(_Info.default,null,_("You can style and position your subplots in the "),_react.default.createElement("a",{onClick:()=>this.context.setPanel("Structure","Subplots")},_("Subplots")),_(" panel.")))}__reactstandin__regenerateByEval(key,code){this[key]=eval(code)}}UnconnectedSubplotCreator.propTypes={container:_propTypes.default.object,fullContainer:_propTypes.default.object};UnconnectedSubplotCreator.contextTypes={data:_propTypes.default.array,fullData:_propTypes.default.array,fullLayout:_propTypes.default.object,localize:_propTypes.default.func,setPanel:_propTypes.default.func};var _default=(0,_lib.connectToContainer)(UnconnectedSubplotCreator,{modifyPlotProps:(props,context,plotProps)=>{var{data}=context;var{fullContainer}=plotProps;plotProps.isVisible=data.length>1&&data[fullContainer.index]&&["geo","mapbox","polar","gl3d","ternary"].some(t=>t===(0,_lib.traceTypeToAxisType)(data[fullContainer.index].type))}});var _default2=exports.default=_default;;(function(){var reactHotLoader=typeof reactHotLoaderGlobal!=="undefined"?reactHotLoaderGlobal.default:undefined;if(!reactHotLoader){return}reactHotLoader.register(UnconnectedSingleSubplotCreator,"UnconnectedSingleSubplotCreator","/Users/razvan/Work/react-chart-editor/src/components/fields/SubplotCreator.js");reactHotLoader.register(SingleSubplotCreator,"SingleSubplotCreator","/Users/razvan/Work/react-chart-editor/src/components/fields/SubplotCreator.js");reactHotLoader.register(UnconnectedSubplotCreator,"UnconnectedSubplotCreator","/Users/razvan/Work/react-chart-editor/src/components/fields/SubplotCreator.js");reactHotLoader.register(_default,"default","/Users/razvan/Work/react-chart-editor/src/components/fields/SubplotCreator.js")})();;(function(){var leaveModule=typeof reactHotLoaderGlobal!=="undefined"?reactHotLoaderGlobal.leaveModule:undefined;leaveModule&&leaveModule(module)})();
//# sourceMappingURL=SubplotCreator.js.map