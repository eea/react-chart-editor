{"version":3,"file":"SubplotAccordion.js","names":["_PlotlyFold","_interopRequireDefault","require","_TraceRequiredPanel","_propTypes","_react","_interopRequireWildcard","_lib","_constants","_getRequireWildcardCache","e","WeakMap","r","t","__esModule","default","has","get","n","__proto__","a","Object","defineProperty","getOwnPropertyDescriptor","u","hasOwnProperty","call","i","set","enterModule","reactHotLoaderGlobal","undefined","module","__signature__","signature","TraceFold","connectTraceToPlot","PlotlyFold","NonCartesianSubplotFold","connectNonCartesianSubplotToLayout","CartesianSubplotFold","connectCartesianSubplotToLayout","SubplotAccordion","Component","render","_this$context","context","_this$context$data","data","_this$context$layout","layout","_","localize","children","props","subplotFolds","allCartesianAxisCombinations","reduce","acc","curVal","inx","TRACE_TO_AXIS","cartesian","some","c","type","xaxis","substring","yaxis","existingComboIndex","findIndex","push","xaxisName","getSubplotTitle","yaxisName","index","forEach","d","createElement","key","traceIndexes","canDelete","name","concat","keys","layoutKey","subplotName","subplotType","trIndex","SUBPLOT_TO_ATTR","trace","tt","startsWith","subplot","counter","pie","table","sunburst","treemap","sankey","parcoords","parcats","values","includes","currentCount","capitalize","__reactstandin__regenerateByEval","code","eval","contextTypes","fullData","PropTypes","array","object","func","propTypes","node","_default","_default2","exports","reactHotLoader","register","leaveModule"],"sources":["../../../src/components/containers/SubplotAccordion.js"],"sourcesContent":["import PlotlyFold from './PlotlyFold';\nimport TraceRequiredPanel from './TraceRequiredPanel';\nimport PropTypes from 'prop-types';\nimport React, {Component} from 'react';\nimport {\n  connectTraceToPlot,\n  connectCartesianSubplotToLayout,\n  connectNonCartesianSubplotToLayout,\n  getSubplotTitle,\n  capitalize,\n} from 'lib';\nimport {TRACE_TO_AXIS, SUBPLOT_TO_ATTR} from 'lib/constants';\n\nconst TraceFold = connectTraceToPlot(PlotlyFold);\nconst NonCartesianSubplotFold = connectNonCartesianSubplotToLayout(PlotlyFold);\nconst CartesianSubplotFold = connectCartesianSubplotToLayout(PlotlyFold);\n\nclass SubplotAccordion extends Component {\n  render() {\n    const {data = [], layout = {}, localize: _} = this.context;\n    const {children} = this.props;\n    const subplotFolds = [];\n\n    const allCartesianAxisCombinations = data.reduce((acc, curVal, inx) => {\n      if (TRACE_TO_AXIS.cartesian.some((c) => c === curVal.type)) {\n        const xaxis = 'xaxis' + (curVal.xaxis ? curVal.xaxis.substring(1) : '');\n        const yaxis = 'yaxis' + (curVal.yaxis ? curVal.yaxis.substring(1) : '');\n\n        const existingComboIndex = acc.findIndex((t) => t.xaxis === xaxis && t.yaxis === yaxis);\n        if (existingComboIndex === -1) {\n          acc.push({\n            xaxis: xaxis,\n            yaxis: yaxis,\n            xaxisName: curVal.xaxis ? getSubplotTitle(curVal.xaxis, 'x', _) : 'X 1',\n            yaxisName: curVal.yaxis ? getSubplotTitle(curVal.yaxis, 'y', _) : 'Y 1',\n            index: [inx],\n          });\n        } else {\n          acc[existingComboIndex].index.push(inx);\n        }\n      }\n      return acc;\n    }, []);\n\n    allCartesianAxisCombinations.forEach(\n      (d) =>\n        (subplotFolds[d.index[0]] = (\n          <CartesianSubplotFold\n            key={d.index[0]}\n            traceIndexes={d.index}\n            canDelete={false}\n            xaxis={d.xaxis}\n            yaxis={d.yaxis}\n            name={`${d.xaxisName} | ${d.yaxisName}`}\n          >\n            {children}\n          </CartesianSubplotFold>\n        ))\n    );\n\n    // For each key in layout, find all traces that belong to this subplot.\n    // E.g. if layout attr is 'ternary', find all traces that are of type\n    // that has subplot ternary, if layout attr is 'ternary2', find traces\n    // of right type that have attr 'subplot': 'ternary' in their data.\n\n    /**\n    Example:\n    {\n      \"data\": [\n        {\n          \"type\": \"scatterternary\",\n          \"mode\": \"markers\",\n        },\n        {\n          \"type\": \"scatterternary\",\n          \"mode\": \"markers\",\n          \"subplot\": \"ternary2\"\n        }\n      ],\n      \"layout\": {\n        \"ternary\": {},\n        \"ternary2\": {},\n      },\n    }\n     */\n\n    Object.keys(layout).forEach((layoutKey) => {\n      const traceIndexes = [];\n      let subplotName;\n      if (\n        ['geo', 'mapbox', 'polar', 'gl3d', 'ternary'].some((subplotType) => {\n          subplotName = getSubplotTitle(layoutKey, subplotType, _);\n          const trIndex =\n            SUBPLOT_TO_ATTR[subplotType].layout === layoutKey\n              ? data.findIndex((trace) =>\n                  TRACE_TO_AXIS[subplotType].some((tt) => tt === trace.type)\n                )\n              : data.findIndex((trace) => trace[SUBPLOT_TO_ATTR[subplotType].data] === layoutKey);\n          if (trIndex !== -1) {\n            traceIndexes.push(trIndex);\n          }\n          return layoutKey.startsWith(SUBPLOT_TO_ATTR[subplotType].layout);\n        })\n      ) {\n        subplotFolds[traceIndexes[0]] = (\n          <NonCartesianSubplotFold\n            key={layoutKey}\n            traceIndexes={traceIndexes}\n            canDelete={false}\n            subplot={layoutKey}\n            name={subplotName}\n          >\n            {children}\n          </NonCartesianSubplotFold>\n        );\n      }\n    });\n\n    const counter = {\n      pie: 0,\n      table: 0,\n      sunburst: 0,\n      treemap: 0,\n      sankey: 0,\n      parcoords: 0,\n      parcats: 0,\n    };\n\n    data.forEach((d, i) => {\n      if (\n        (d.type === 'pie' && d.values) ||\n        [\n          'pie',\n          'table',\n          'sunburst',\n          'treemap',\n          'sankey',\n          'parcoords',\n          'parcats',\n          'funnelarea',\n        ].includes(d.type)\n      ) {\n        counter[d.type]++;\n        const currentCount = counter[d.type];\n\n        subplotFolds[i] = (\n          <TraceFold\n            key={i}\n            traceIndexes={[i]}\n            canDelete={false}\n            name={capitalize(d.type) + (currentCount > 1 ? ' ' + currentCount : '')}\n          >\n            {children}\n          </TraceFold>\n        );\n      }\n    });\n\n    return <TraceRequiredPanel>{subplotFolds}</TraceRequiredPanel>;\n  }\n}\n\nSubplotAccordion.contextTypes = {\n  fullData: PropTypes.array,\n  data: PropTypes.array,\n  layout: PropTypes.object,\n  localize: PropTypes.func,\n};\n\nSubplotAccordion.propTypes = {\n  children: PropTypes.node,\n};\n\nexport default SubplotAccordion;\n"],"mappings":"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","ignoreList":[]}