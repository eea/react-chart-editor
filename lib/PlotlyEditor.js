"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.default=void 0;var _react=_interopRequireWildcard(require("react"));var _pick=_interopRequireDefault(require("lodash/pick"));var _isNil=_interopRequireDefault(require("lodash/isNil"));var _propTypes=_interopRequireDefault(require("prop-types"));var _constants=require("./lib/constants");var _factory=_interopRequireDefault(require("react-plotly.js/factory"));var _EditorControls=_interopRequireDefault(require("./EditorControls"));var _DataSourcesEditor=_interopRequireDefault(require("./DataSourcesEditor"));function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}function _getRequireWildcardCache(e){if("function"!=typeof WeakMap)return null;var r=new WeakMap,t=new WeakMap;return(_getRequireWildcardCache=function _getRequireWildcardCache(e){return e?t:r})(e)}function _interopRequireWildcard(e,r){if(!r&&e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var t=_getRequireWildcardCache(r);if(t&&t.has(e))return t.get(e);var n={__proto__:null},a=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var u in e)if("default"!==u&&{}.hasOwnProperty.call(e,u)){var i=a?Object.getOwnPropertyDescriptor(e,u):null;i&&(i.get||i.set)?Object.defineProperty(n,u,i):n[u]=e[u]}return n.default=e,t&&t.set(e,n),n}(function(){var enterModule=typeof reactHotLoaderGlobal!=="undefined"?reactHotLoaderGlobal.enterModule:undefined;enterModule&&enterModule(module)})();function ownKeys(e,r){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);r&&(o=o.filter(function(r){return Object.getOwnPropertyDescriptor(e,r).enumerable})),t.push.apply(t,o)}return t}function _objectSpread(e){for(var r=1;r<arguments.length;r++){var t=null!=arguments[r]?arguments[r]:{};r%2?ownKeys(Object(t),!0).forEach(function(r){_defineProperty(e,r,t[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):ownKeys(Object(t)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(t,r))})}return e}function _defineProperty(e,r,t){return(r=_toPropertyKey(r))in e?Object.defineProperty(e,r,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[r]=t,e}function _toPropertyKey(t){var i=_toPrimitive(t,"string");return"symbol"==typeof i?i:i+""}function _toPrimitive(t,r){if("object"!=typeof t||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var i=e.call(t,r||"default");if("object"!=typeof i)return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===r?String:Number)(t)}var __signature__=typeof reactHotLoaderGlobal!=="undefined"?reactHotLoaderGlobal.default.signature:function(a){return a};class PlotlyEditor extends _react.Component{constructor(props){super();this.state={graphDiv:{},dfltGraphDiv:{_fullData:[],_fullLayout:{}},dfltData:[],dfltLayout:{},initialized:false};this.EditorControls=(0,_react.createRef)();this.DataSourcesEditor=(0,_react.createRef)();this.PlotComponent=(0,_factory.default)(props.plotly);this.handleRender=this.handleRender.bind(this);this.onUpdate=this.onUpdate.bind(this);this.loadDataSources=this.loadDataSources.bind(this);this.onPlotResize=this.onPlotResize.bind(this);this.renderSlot=this.renderSlot.bind(this)}componentDidUpdate(prevProps,prevState){if(!this.state.initialized){return}var{data,layout}=this.props;if(data!==prevProps.data||layout!==prevProps.layout||this.state.initialized!==prevState.initialized){var _layout$xaxis,_layout$annotations,_layout$shapes,_layout$images;this.setState({dfltData:data.map(trace=>_objectSpread(_objectSpread({},(0,_pick.default)(trace,["type","xaxis","yaxis",..._constants.TRACE_SRC_ATTRIBUTES.filter(attr=>!attr.includes("."))])),!(0,_isNil.default)(trace.autocolorscale)?{autocolorscale:true}:{})),dfltLayout:_objectSpread(_objectSpread(_objectSpread(_objectSpread(_objectSpread({},(0,_pick.default)(layout,["template",..._constants.LAYOUT_SRC_ATTRIBUTES])),(_layout$xaxis=layout.xaxis)!==null&&_layout$xaxis!==void 0&&(_layout$xaxis=_layout$xaxis.rangeslider)!==null&&_layout$xaxis!==void 0&&_layout$xaxis.visible?{xaxis:{rangeslider:{visible:true}}}:{}),(_layout$annotations=layout.annotations)!==null&&_layout$annotations!==void 0&&_layout$annotations.length?{annotations:layout.annotations.map(()=>({}))}:{}),(_layout$shapes=layout.shapes)!==null&&_layout$shapes!==void 0&&_layout$shapes.length?{shapes:layout.shapes.map(()=>({}))}:{}),(_layout$images=layout.images)!==null&&_layout$images!==void 0&&_layout$images.length?{images:layout.images.map(()=>({}))}:{})})}}handleRender(fig,graphDiv){if(!this.props.forceRender){this.setState({graphDiv})}if(this.props.forceRender){this.props.forceRender(fig,graphDiv)}if(this.props.onRender){this.props.onRender(fig,graphDiv)}}onUpdate(_ref){var{type,payload}=_ref;var editor=this.EditorControls.current;return editor.handleUpdate.bind(editor)({type,payload})}loadDataSources(dataSources,update){var editor=this.DataSourcesEditor.current;return editor.loadDataSources.bind(editor)(dataSources,update)}onPlotResize(){var containerEl=document.querySelector(".grid_and_plot");var gridEl=containerEl.querySelector(".grid_panel");var previewEl=containerEl.querySelector(".grid_panel__resize-preview");var plotEl=containerEl.querySelector(".plot_panel");requestAnimationFrame(()=>{plotEl.style.maxHeight=Math.max(_constants.MIN_PLOT_HEIGHT,containerEl.clientHeight-(gridEl.clientHeight+previewEl.clientHeight)-1)+"px";window.dispatchEvent(new Event("resize"))})}renderSlot(slot){var _this$props$slots;return((_this$props$slots=this.props.slots)===null||_this$props$slots===void 0?void 0:_this$props$slots[slot])||null}render(){return _react.default.createElement("div",{className:"plotly_editor plotly-editor--theme-provider"},!this.props.hideControls&&_react.default.createElement(_EditorControls.default,{ref:this.EditorControls,customColors:this.props.customColors,graphDiv:this.state.graphDiv,dfltGraphDiv:this.state.dfltGraphDiv,dataSources:this.props.dataSources,dataSourceOptions:this.props.dataSourceOptions,defaults:this.props.defaults,plotly:this.props.plotly,onUpdate:this.props.onUpdate,onUpdateDataSources:this.props.onUpdateDataSources,advancedTraceTypeSelector:this.props.advancedTraceTypeSelector,locale:this.props.locale,traceTypesConfig:this.props.traceTypesConfig,dictionaries:this.props.dictionaries,showFieldTooltips:this.props.showFieldTooltips,srcConverters:this.props.srcConverters,makeDefaultTrace:this.props.makeDefaultTrace,glByDefault:this.props.glByDefault,mapBoxAccess:Boolean(this.props.config&&this.props.config.mapboxAccessToken),fontOptions:this.props.fontOptions,chartHelp:this.props.chartHelp,customConfig:this.props.customConfig,ctx:this.props.ctx},this.props.children),_react.default.createElement("div",{className:"grid_and_plot"},this.renderSlot("grid-and-plot"),_react.default.createElement(_DataSourcesEditor.default,{ref:this.DataSourcesEditor,data:this.props.data,layout:this.props.layout,dataSources:this.props.dataSourcesSubset||this.props.dataSources,srcConverters:this.props.srcConverters,onUpdate:this.onUpdate,onPlotResize:this.onPlotResize}),_react.default.createElement("div",{className:"plot_panel"},_react.default.createElement(this.PlotComponent,{data:this.props.data,layout:this.props.layout,frames:this.props.frames,config:this.props.config,useResizeHandler:this.props.useResizeHandler,debug:this.props.debug,onInitialized:(fig,graphDiv)=>{this.onPlotResize();this.setState({initialized:true,graphDiv},()=>{var{data,layout,frames}=fig;if(this.props.onInitialized){this.props.onInitialized(fig,graphDiv)}if(this.props.onUpdate){this.props.onUpdate(data,layout,frames)}})},onUpdate:(fig,graphDiv)=>this.state.initialized?this.handleRender(fig,graphDiv):null,style:{width:"100%",height:"100%"},divId:this.props.divId}),this.state.initialized&&_react.default.createElement(this.PlotComponent,{data:this.state.dfltData,layout:this.state.dfltLayout,frames:this.props.frames,config:this.props.config,divId:"plotly-dflt",onInitialized:(_,graphDiv)=>this.setState({dfltGraphDiv:graphDiv})}))))}__reactstandin__regenerateByEval(key,code){this[key]=eval(code)}}PlotlyEditor.propTypes={children:_propTypes.default.any,layout:_propTypes.default.object,data:_propTypes.default.array,config:_propTypes.default.object,customColors:_propTypes.default.array,defaults:_propTypes.default.object,dataSources:_propTypes.default.object,dataSourcesSubset:_propTypes.default.object,dataSourceOptions:_propTypes.default.array,frames:_propTypes.default.array,onUpdate:_propTypes.default.func,onUpdateDataSources:_propTypes.default.func,onRender:_propTypes.default.func,forceRender:_propTypes.default.func,onInitialized:_propTypes.default.func,plotly:_propTypes.default.object,useResizeHandler:_propTypes.default.bool,debug:_propTypes.default.bool,advancedTraceTypeSelector:_propTypes.default.bool,locale:_propTypes.default.string,traceTypesConfig:_propTypes.default.object,dictionaries:_propTypes.default.object,divId:_propTypes.default.string,hideControls:_propTypes.default.bool,showFieldTooltips:_propTypes.default.bool,srcConverters:_propTypes.default.shape({toSrc:_propTypes.default.func.isRequired,fromSrc:_propTypes.default.func.isRequired}),makeDefaultTrace:_propTypes.default.func,glByDefault:_propTypes.default.bool,fontOptions:_propTypes.default.array,chartHelp:_propTypes.default.object,customConfig:_propTypes.default.object,ctx:_propTypes.default.object,slots:_propTypes.default.objectOf(_propTypes.default.element)};PlotlyEditor.defaultProps={hideControls:false,showFieldTooltips:false,fontOptions:_constants.DEFAULT_FONTS};var _default=PlotlyEditor;var _default2=exports.default=_default;;(function(){var reactHotLoader=typeof reactHotLoaderGlobal!=="undefined"?reactHotLoaderGlobal.default:undefined;if(!reactHotLoader){return}reactHotLoader.register(PlotlyEditor,"PlotlyEditor","/Users/razvan/Work/react-chart-editor/src/PlotlyEditor.js");reactHotLoader.register(_default,"default","/Users/razvan/Work/react-chart-editor/src/PlotlyEditor.js")})();;(function(){var leaveModule=typeof reactHotLoaderGlobal!=="undefined"?reactHotLoaderGlobal.leaveModule:undefined;leaveModule&&leaveModule(module)})();
//# sourceMappingURL=PlotlyEditor.js.map