"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.default=dereference;exports.getColumnNames=getColumnNames;var _walkObject=_interopRequireDefault(require("./walkObject"));var _index=require("./index");function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}(function(){var enterModule=typeof reactHotLoaderGlobal!=="undefined"?reactHotLoaderGlobal.enterModule:undefined;enterModule&&enterModule(module)})();var __signature__=typeof reactHotLoaderGlobal!=="undefined"?reactHotLoaderGlobal.default.signature:function(a){return a};const SRC_ATTR_PATTERN=/src$/;function getColumnNames(srcArray,dataSourceOptions){return srcArray.map(src=>{const columns=dataSourceOptions.filter(dso=>dso.value===src);if(columns.length===1){return columns[0].columnName||columns[0].label}return""}).join(" - ")}function dereference(container,dataSources){let config=arguments.length>2&&arguments[2]!==undefined?arguments[2]:{deleteKeys:false};let dataSourceOptions=arguments.length>3&&arguments[3]!==undefined?arguments[3]:null;const containerIsData=Array.isArray(container);const replacer=(key,parent,srcPath)=>{if(!SRC_ATTR_PATTERN.test(key)){return}const dataKey=key.replace(SRC_ATTR_PATTERN,"");let srcRef=config.toSrc?config.toSrc(parent[key]):parent[key];if(!Array.isArray(srcRef)){srcRef=[srcRef]}let dereferencedData=srcRef.map(ref=>{if(config.deleteKeys&&!(ref in dataSources)){delete parent[dataKey];delete parent[dataKey+"src"]}return dataSources[ref]});if(srcRef.length===1){dereferencedData=dereferencedData[0]}if(!Array.isArray(dereferencedData)){return}if(containerIsData){if(parent.type!==null){if(dataSourceOptions!==null){parent.meta=parent.meta||{};parent.meta.columnNames=parent.meta.columnNames||{};parent.meta.columnNames[dataKey]=getColumnNames(srcRef,dataSourceOptions)}parent[dataKey]=(0,_index.maybeTransposeData)(dereferencedData,srcPath,parent.type)}else{parent[dataKey]=dereferencedData}}else{parent[dataKey]=dereferencedData}};if(containerIsData){(0,_walkObject.default)(container,replacer,{walkArraysMatchingKeys:["data","transforms"],pathType:"nestedProperty"})}else{(0,_walkObject.default)(container,replacer,{pathType:"nestedProperty"})}};(function(){var reactHotLoader=typeof reactHotLoaderGlobal!=="undefined"?reactHotLoaderGlobal.default:undefined;if(!reactHotLoader){return}reactHotLoader.register(SRC_ATTR_PATTERN,"SRC_ATTR_PATTERN","/Users/razvan/Work/react-chart-editor/src/lib/dereference.js");reactHotLoader.register(getColumnNames,"getColumnNames","/Users/razvan/Work/react-chart-editor/src/lib/dereference.js");reactHotLoader.register(dereference,"dereference","/Users/razvan/Work/react-chart-editor/src/lib/dereference.js")})();;(function(){var leaveModule=typeof reactHotLoaderGlobal!=="undefined"?reactHotLoaderGlobal.leaveModule:undefined;leaveModule&&leaveModule(module)})();
//# sourceMappingURL=dereference.js.map