{"version":3,"file":"unpackPlotProps.js","names":["_nested_property","_interopRequireDefault","require","_fastIsnumeric","_constants","e","__esModule","default","enterModule","reactHotLoaderGlobal","undefined","module","__signature__","signature","a","hasFullValue","fullValue","hasValidCustomConfigVisibilityRules","customConfig","Object","keys","length","visibility_rules","blacklist","whitelist","console","error","some","key","includes","isValidRule","rule","exceptions","every","type","regex_match","errorMessage","computeCustomConfigVisibility","props","wrappedComponentDisplayName","isVisible","isRegexMatch","stringToTest","attr","RegExp","test","passesTest","hasException","exception","isVisibleGivenCustomConfig","initial","nextProps","nextContext","componentDisplayName","show","unpackPlotProps","context","container","getValObject","defaultContainer","updateContainer","attrMeta","fullContainer","fullProperty","nestedProperty","get","multiValued","MULTI_VALUED","MULTI_VALUED_PLACEHOLDER","Boolean","defaultValue","min","max","description","isNumeric","updatePlot","v","reactHotLoader","register","leaveModule"],"sources":["../../src/lib/unpackPlotProps.js"],"sourcesContent":["/* eslint-disable no-console */\n\nimport nestedProperty from 'plotly.js/src/lib/nested_property';\nimport isNumeric from 'fast-isnumeric';\nimport {MULTI_VALUED, MULTI_VALUED_PLACEHOLDER} from './constants';\n\nconst hasFullValue = (fullValue) => fullValue !== void 0 && fullValue !== null;\n\nexport function hasValidCustomConfigVisibilityRules(customConfig) {\n  if (\n    customConfig &&\n    customConfig === Object(customConfig) &&\n    Object.keys(customConfig).length &&\n    customConfig.visibility_rules\n  ) {\n    if (customConfig.visibility_rules.blacklist && customConfig.visibility_rules.whitelist) {\n      console.error(\n        'customConfig.visibility_rules can have a blacklist OR whitelist key, both are present in your config.'\n      );\n      return false;\n    }\n\n    if (\n      !Object.keys(customConfig.visibility_rules).some((key) =>\n        ['blacklist', 'whitelist'].includes(key)\n      )\n    ) {\n      console.error(\n        'customConfig.visibility_rules must have at least a blacklist or whitelist key.'\n      );\n      return false;\n    }\n\n    const isValidRule = (rule) => {\n      if (rule.exceptions) {\n        return rule.exceptions.every(isValidRule);\n      }\n      return rule.type && ['attrName', 'controlType'].includes(rule.type) && rule.regex_match;\n    };\n\n    const errorMessage =\n      \"All rules and exceptions must have a type (one of: 'attrName' or 'controlType') and regex_match key.\";\n\n    if (\n      customConfig.visibility_rules.blacklist &&\n      !customConfig.visibility_rules.blacklist.every(isValidRule)\n    ) {\n      console.error(errorMessage);\n      return false;\n    }\n\n    if (\n      customConfig.visibility_rules.whitelist &&\n      !customConfig.visibility_rules.whitelist.every(isValidRule)\n    ) {\n      console.error(errorMessage);\n      return false;\n    }\n\n    return true;\n  }\n  return false;\n}\n\nexport function computeCustomConfigVisibility(props, customConfig, wrappedComponentDisplayName) {\n  let isVisible;\n\n  const isRegexMatch = (rule) => {\n    const stringToTest = rule.type === 'attrName' ? props.attr : wrappedComponentDisplayName;\n    return RegExp(rule.regex_match).test(stringToTest);\n  };\n\n  const passesTest = (rule) => {\n    const hasException = (rule) => {\n      if (rule.exceptions) {\n        return rule.exceptions.some((exception) => passesTest(exception));\n      }\n      return false;\n    };\n    return isRegexMatch(rule) && !hasException(rule);\n  };\n\n  if (customConfig.visibility_rules.blacklist) {\n    isVisible = !customConfig.visibility_rules.blacklist.some(passesTest);\n  }\n\n  if (customConfig.visibility_rules.whitelist) {\n    isVisible = customConfig.visibility_rules.whitelist.some(passesTest);\n  }\n\n  return isVisible;\n}\n\nexport function isVisibleGivenCustomConfig(initial, nextProps, nextContext, componentDisplayName) {\n  let show = initial;\n  if (show && nextContext.hasValidCustomConfigVisibilityRules) {\n    show = computeCustomConfigVisibility(nextProps, nextContext.customConfig, componentDisplayName);\n  }\n  return show;\n}\n\nexport default function unpackPlotProps(props, context) {\n  const {container, getValObject, defaultContainer, updateContainer} = context;\n\n  if (!props.attr) {\n    return {};\n  }\n\n  let attrMeta;\n  if (getValObject) {\n    attrMeta = context.getValObject(props.attr) || {};\n  }\n\n  const fullContainer = context.fullContainer;\n\n  const fullProperty = nestedProperty(fullContainer, props.attr);\n  let fullValue = fullProperty.get();\n  let multiValued = false;\n\n  // MULTI_VALUED consists of a control sequence that cannot be confused with\n  // user data. We must transform it into something that can be displayed as\n  // the screen.\n  if (fullValue === MULTI_VALUED) {\n    fullValue = MULTI_VALUED_PLACEHOLDER;\n    multiValued = true;\n  }\n\n  const isVisible = Boolean(hasFullValue(fullValue) || props.show);\n\n  let defaultValue = props.defaultValue;\n  if (defaultValue === void 0 && defaultContainer) {\n    defaultValue = nestedProperty(defaultContainer, props.attr).get();\n  }\n\n  let min, max, description;\n  if (attrMeta) {\n    if (isNumeric(attrMeta.max)) {\n      max = attrMeta.max;\n    }\n    if (isNumeric(attrMeta.min)) {\n      min = attrMeta.min;\n    }\n\n    description = attrMeta.description;\n  }\n\n  const updatePlot = (v) => {\n    if (updateContainer) {\n      updateContainer({[props.attr]: v});\n    }\n  };\n\n  return {\n    attrMeta,\n    container,\n    defaultValue,\n    fullContainer,\n    fullValue,\n    getValObject,\n    isVisible,\n    max,\n    min,\n    description,\n    multiValued,\n    updateContainer,\n    updatePlot,\n  };\n}\n"],"mappings":"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","ignoreList":[]}