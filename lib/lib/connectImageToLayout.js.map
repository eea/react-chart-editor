{"version":3,"file":"connectImageToLayout.js","names":["_react","_interopRequireWildcard","require","_propTypes","_interopRequireDefault","_nested_property","_lib","_constants","e","__esModule","default","_getRequireWildcardCache","WeakMap","r","t","has","get","n","__proto__","a","Object","defineProperty","getOwnPropertyDescriptor","u","hasOwnProperty","call","i","set","enterModule","reactHotLoaderGlobal","undefined","module","__signature__","signature","connectImageToLayout","WrappedComponent","ImageConnectedComponent","Component","constructor","props","context","deleteImage","bind","updateImage","moveImage","setLocals","UNSAFE_componentWillReceiveProps","nextProps","nextContext","imageIndex","container","fullContainer","images","fullImages","getChildContext","dfltGraphDiv","getDflt","attr","_nestedProperty$get","_dfltGraphDiv$_fullLa","nestedProperty","_fullLayout","_template","getValObject","concat","updateContainer","deleteContainer","moveContainer","update","newUpdate","key","newkey","onUpdate","type","EDITOR_ACTIONS","DELETE_IMAGE","payload","direction","desiredIndex","MOVE_TO","fromIndex","toIndex","path","render","createElement","__reactstandin__regenerateByEval","code","eval","displayName","getDisplayName","propTypes","PropTypes","number","isRequired","contextTypes","object","data","array","func","any","childContextTypes","plotly_editor_traits","reactHotLoader","register","leaveModule"],"sources":["../../src/lib/connectImageToLayout.js"],"sourcesContent":["import React, {Component} from 'react';\nimport PropTypes from 'prop-types';\nimport nestedProperty from 'plotly.js/src/lib/nested_property';\nimport {getDisplayName} from '../lib';\nimport {EDITOR_ACTIONS} from './constants';\n\nexport default function connectImageToLayout(WrappedComponent) {\n  class ImageConnectedComponent extends Component {\n    constructor(props, context) {\n      super(props, context);\n\n      this.deleteImage = this.deleteImage.bind(this);\n      this.updateImage = this.updateImage.bind(this);\n      this.moveImage = this.moveImage.bind(this);\n      this.setLocals(props, context);\n    }\n\n    UNSAFE_componentWillReceiveProps(nextProps, nextContext) {\n      this.setLocals(nextProps, nextContext);\n    }\n\n    setLocals(props, context) {\n      const {imageIndex} = props;\n      const {container, fullContainer} = context;\n\n      const images = container.images || [];\n      const fullImages = fullContainer.images || [];\n      this.container = images[imageIndex];\n      this.fullContainer = fullImages[imageIndex];\n    }\n\n    getChildContext() {\n      const {imageIndex} = this.props;\n      const {dfltGraphDiv} = this.context;\n      return {\n        getDflt: (attr) => {\n          return (\n            nestedProperty(\n              dfltGraphDiv._fullLayout.images[imageIndex]?._template || {},\n              attr\n            ).get() ?? nestedProperty(dfltGraphDiv._fullLayout.images[imageIndex], attr).get()\n          );\n        },\n        getValObject: (attr) =>\n          !this.context.getValObject ? null : this.context.getValObject(`images[].${attr}`),\n        updateContainer: this.updateImage,\n        deleteContainer: this.deleteImage,\n        container: this.container,\n        fullContainer: this.fullContainer,\n        moveContainer: this.moveImage,\n      };\n    }\n\n    updateImage(update) {\n      const newUpdate = {};\n      const {imageIndex} = this.props;\n      for (const key in update) {\n        const newkey = `images[${imageIndex}].${key}`;\n        newUpdate[newkey] = update[key];\n      }\n      this.context.updateContainer(newUpdate);\n    }\n\n    deleteImage() {\n      if (this.context.onUpdate) {\n        this.context.onUpdate({\n          type: EDITOR_ACTIONS.DELETE_IMAGE,\n          payload: {imageIndex: this.props.imageIndex},\n        });\n      }\n    }\n\n    moveImage(direction) {\n      if (this.context.onUpdate) {\n        const imageIndex = this.props.imageIndex;\n        const desiredIndex = direction === 'up' ? imageIndex - 1 : imageIndex + 1;\n        this.context.onUpdate({\n          type: EDITOR_ACTIONS.MOVE_TO,\n          payload: {\n            fromIndex: imageIndex,\n            toIndex: desiredIndex,\n            path: 'layout.images',\n          },\n        });\n      }\n    }\n\n    render() {\n      return <WrappedComponent {...this.props} />;\n    }\n  }\n\n  ImageConnectedComponent.displayName = `ImageConnected${getDisplayName(WrappedComponent)}`;\n\n  ImageConnectedComponent.propTypes = {\n    imageIndex: PropTypes.number.isRequired,\n  };\n\n  ImageConnectedComponent.contextTypes = {\n    container: PropTypes.object,\n    fullContainer: PropTypes.object,\n    data: PropTypes.array,\n    onUpdate: PropTypes.func,\n    updateContainer: PropTypes.func,\n    getValObject: PropTypes.func,\n    dfltGraphDiv: PropTypes.any,\n  };\n\n  ImageConnectedComponent.childContextTypes = {\n    updateContainer: PropTypes.func,\n    deleteContainer: PropTypes.func,\n    container: PropTypes.object,\n    fullContainer: PropTypes.object,\n    getDflt: PropTypes.func,\n    getValObject: PropTypes.func,\n    moveContainer: PropTypes.func,\n  };\n\n  const {plotly_editor_traits} = WrappedComponent;\n  ImageConnectedComponent.plotly_editor_traits = plotly_editor_traits;\n\n  return ImageConnectedComponent;\n}\n"],"mappings":"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","ignoreList":[]}