"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.computeCustomConfigVisibility=computeCustomConfigVisibility;exports.default=unpackPlotProps;exports.hasValidCustomConfigVisibilityRules=hasValidCustomConfigVisibilityRules;exports.isVisibleGivenCustomConfig=isVisibleGivenCustomConfig;var _isEqual2=_interopRequireDefault(require("lodash/isEqual"));var _isNil=_interopRequireDefault(require("lodash/isNil"));var _isString=_interopRequireDefault(require("lodash/isString"));var _isArray=_interopRequireDefault(require("lodash/isArray"));var _nested_property=_interopRequireDefault(require("plotly.js/src/lib/nested_property"));var _fastIsnumeric=_interopRequireDefault(require("fast-isnumeric"));var _tinycolor=_interopRequireDefault(require("tinycolor2"));var _constants=require("./constants");function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}(function(){var enterModule=typeof reactHotLoaderGlobal!=="undefined"?reactHotLoaderGlobal.enterModule:undefined;enterModule&&enterModule(module)})();function ownKeys(e,r){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);r&&(o=o.filter(function(r){return Object.getOwnPropertyDescriptor(e,r).enumerable})),t.push.apply(t,o)}return t}function _objectSpread(e){for(var r=1;r<arguments.length;r++){var t=null!=arguments[r]?arguments[r]:{};r%2?ownKeys(Object(t),!0).forEach(function(r){_defineProperty(e,r,t[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):ownKeys(Object(t)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(t,r))})}return e}function _defineProperty(e,r,t){return(r=_toPropertyKey(r))in e?Object.defineProperty(e,r,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[r]=t,e}function _toPropertyKey(t){var i=_toPrimitive(t,"string");return"symbol"==typeof i?i:i+""}function _toPrimitive(t,r){if("object"!=typeof t||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var i=e.call(t,r||"default");if("object"!=typeof i)return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===r?String:Number)(t)}var __signature__=typeof reactHotLoaderGlobal!=="undefined"?reactHotLoaderGlobal.default.signature:function(a){return a};var hasFullValue=fullValue=>fullValue!==void 0&&fullValue!==null;function isEqual(a,b){if((0,_isString.default)(a)&&(0,_isString.default)(b)){var c1=(0,_tinycolor.default)(a);var c2=(0,_tinycolor.default)(b);if(c1.isValid()&&c2.isValid()){return _tinycolor.default.equals(c1,c2)}}if((0,_isArray.default)(a)&&(0,_isArray.default)(b)){return a.length===b.length&&a.every((v,i)=>isEqual(v,b[i]))}return(0,_isEqual2.default)(a,b)}function hasValidCustomConfigVisibilityRules(customConfig){if(customConfig&&customConfig===Object(customConfig)&&Object.keys(customConfig).length&&customConfig.visibility_rules){if(customConfig.visibility_rules.blacklist&&customConfig.visibility_rules.whitelist){console.error("customConfig.visibility_rules can have a blacklist OR whitelist key, both are present in your config.");return false}if(!Object.keys(customConfig.visibility_rules).some(key=>["blacklist","whitelist"].includes(key))){console.error("customConfig.visibility_rules must have at least a blacklist or whitelist key.");return false}var isValidRule=rule=>{if(rule.exceptions){return rule.exceptions.every(isValidRule)}return rule.type&&["attrName","controlType"].includes(rule.type)&&rule.regex_match};var errorMessage="All rules and exceptions must have a type (one of: 'attrName' or 'controlType') and regex_match key.";if(customConfig.visibility_rules.blacklist&&!customConfig.visibility_rules.blacklist.every(isValidRule)){console.error(errorMessage);return false}if(customConfig.visibility_rules.whitelist&&!customConfig.visibility_rules.whitelist.every(isValidRule)){console.error(errorMessage);return false}return true}return false}function computeCustomConfigVisibility(props,customConfig,wrappedComponentDisplayName){var isVisible;var isRegexMatch=rule=>{var stringToTest=rule.type==="attrName"?props.attr:wrappedComponentDisplayName;return RegExp(rule.regex_match).test(stringToTest)};var passesTest=rule=>{var hasException=rule=>{if(rule.exceptions){return rule.exceptions.some(exception=>passesTest(exception))}return false};return isRegexMatch(rule)&&!hasException(rule)};if(customConfig.visibility_rules.blacklist){isVisible=!customConfig.visibility_rules.blacklist.some(passesTest)}if(customConfig.visibility_rules.whitelist){isVisible=customConfig.visibility_rules.whitelist.some(passesTest)}return isVisible}function isVisibleGivenCustomConfig(initial,nextProps,nextContext,componentDisplayName){var show=initial;if(show&&nextContext.hasValidCustomConfigVisibilityRules){show=computeCustomConfigVisibility(nextProps,nextContext.customConfig,componentDisplayName)}return show}function unpackPlotProps(props,context){var{container,getDflt,getValObject,defaultContainer,updateContainer}=context;if(!props.attr){return{}}var attrMeta;if(getValObject){attrMeta=context.getValObject(props.attr)||{}}var fullContainer=context.fullContainer;var fullProperty=(0,_nested_property.default)(fullContainer,props.attr);var fullValue=fullProperty.get();var multiValued=false;if(fullValue===_constants.MULTI_VALUED){fullValue=_constants.MULTI_VALUED_PLACEHOLDER;multiValued=true}var isVisible=Boolean(hasFullValue(fullValue)||props.show);var defaultValue=props.defaultValue;if(defaultValue===void 0&&defaultContainer){defaultValue=(0,_nested_property.default)(defaultContainer,props.attr).get()}var min,max,description;if(attrMeta){if((0,_fastIsnumeric.default)(attrMeta.max)){max=attrMeta.max}if((0,_fastIsnumeric.default)(attrMeta.min)){min=attrMeta.min}description=attrMeta.description}var updatePlot=function updatePlot(v){var _update=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{};if(!props.attr||!updateContainer){return}var update=_objectSpread({},_update);if((props.resettable||context.resettable&&props.resettable!==false)&&!(0,_isNil.default)(v)){var dflt=getDflt(props.attr);var equal=isEqual(v,dflt);if(equal&&update.autocolorscale===false){update.autocolorscale=true}update[props.attr]=equal?null:v;console.log("[DEBUG] ".concat(props.attr),v,"=",dflt,"=>",equal)}else{update[props.attr]=v}if(updateContainer){updateContainer(update)}};return{attrMeta,container,defaultValue,fullContainer,fullValue,getValObject,isVisible,max,min,description,multiValued,updateContainer,updatePlot}};(function(){var reactHotLoader=typeof reactHotLoaderGlobal!=="undefined"?reactHotLoaderGlobal.default:undefined;if(!reactHotLoader){return}reactHotLoader.register(hasFullValue,"hasFullValue","/Users/razvan/Work/react-chart-editor/src/lib/unpackPlotProps.js");reactHotLoader.register(isEqual,"isEqual","/Users/razvan/Work/react-chart-editor/src/lib/unpackPlotProps.js");reactHotLoader.register(hasValidCustomConfigVisibilityRules,"hasValidCustomConfigVisibilityRules","/Users/razvan/Work/react-chart-editor/src/lib/unpackPlotProps.js");reactHotLoader.register(computeCustomConfigVisibility,"computeCustomConfigVisibility","/Users/razvan/Work/react-chart-editor/src/lib/unpackPlotProps.js");reactHotLoader.register(isVisibleGivenCustomConfig,"isVisibleGivenCustomConfig","/Users/razvan/Work/react-chart-editor/src/lib/unpackPlotProps.js");reactHotLoader.register(unpackPlotProps,"unpackPlotProps","/Users/razvan/Work/react-chart-editor/src/lib/unpackPlotProps.js")})();;(function(){var leaveModule=typeof reactHotLoaderGlobal!=="undefined"?reactHotLoaderGlobal.leaveModule:undefined;leaveModule&&leaveModule(module)})();
//# sourceMappingURL=unpackPlotProps.js.map